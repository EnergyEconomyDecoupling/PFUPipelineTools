<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-US"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Filter a table from the database using natural expressions — pl_filter_collect • PFUPipelineTools</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Filter a table from the database using natural expressions — pl_filter_collect"><meta name="description" content="Often when collecting data from the database,
filtering is desired.
But filtering based on foreign keys
(fks, as stored in the database)
is effectively impossible, because of foreign key encoding.
This function filters based on
fk values (typically strings),
not fk keys (typically integers),
thereby simplifying the filtering process,
with optional downloading thereafter.
By default (collect = FALSE),
a tbl is returned
(and data are not downloaded from the database).
Use dplyr::collect() to execute the resulting SQL query
and obtain an in-memory data frame.
Or, set collect = TRUE to execute the SQL and
return an in-memory data frame."><meta property="og:description" content="Often when collecting data from the database,
filtering is desired.
But filtering based on foreign keys
(fks, as stored in the database)
is effectively impossible, because of foreign key encoding.
This function filters based on
fk values (typically strings),
not fk keys (typically integers),
thereby simplifying the filtering process,
with optional downloading thereafter.
By default (collect = FALSE),
a tbl is returned
(and data are not downloaded from the database).
Use dplyr::collect() to execute the resulting SQL query
and obtain an in-memory data frame.
Or, set collect = TRUE to execute the SQL and
return an in-memory data frame."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">PFUPipelineTools</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.13</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Filter a table from the database using natural expressions</h1>

      <div class="d-none name"><code>pl_filter_collect.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Often when collecting data from the database,
filtering is desired.
But filtering based on foreign keys
(fks, as stored in the database)
is effectively impossible, because of foreign key encoding.
This function filters based on
fk values (typically strings),
not fk keys (typically integers),
thereby simplifying the filtering process,
with optional downloading thereafter.
By default (<code>collect = FALSE</code>),
a <code>tbl</code> is returned
(and data are not downloaded from the database).
Use <code><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">dplyr::collect()</a></code> to execute the resulting SQL query
and obtain an in-memory data frame.
Or, set <code>collect = TRUE</code> to execute the SQL and
return an in-memory data frame.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">pl_filter_collect</span><span class="op">(</span></span>
<span>  <span class="va">db_table_name</span>,</span>
<span>  <span class="va">...</span>,</span>
<span>  version_string <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  collect <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  create_matsindf <span class="op">=</span> <span class="va">collect</span>,</span>
<span>  <span class="va">conn</span>,</span>
<span>  schema <span class="op">=</span> <span class="fu"><a href="schema_from_conn.html">schema_from_conn</a></span><span class="op">(</span>conn <span class="op">=</span> <span class="va">conn</span><span class="op">)</span>,</span>
<span>  fk_parent_tables <span class="op">=</span> <span class="fu"><a href="get_all_fk_tables.html">get_all_fk_tables</a></span><span class="op">(</span>conn <span class="op">=</span> <span class="va">conn</span>, schema <span class="op">=</span> <span class="va">schema</span><span class="op">)</span>,</span>
<span>  index_map_name <span class="op">=</span> <span class="st">"Index"</span>,</span>
<span>  index_map <span class="op">=</span> <span class="va">fk_parent_tables</span><span class="op">[[</span><span class="va">index_map_name</span><span class="op">]</span><span class="op">]</span>,</span>
<span>  rctype_table_name <span class="op">=</span> <span class="st">"matnameRCType"</span>,</span>
<span>  rctypes <span class="op">=</span> <span class="fu"><a href="decode_fks.html">decode_fks</a></span><span class="op">(</span>db_table_name <span class="op">=</span> <span class="va">rctype_table_name</span>, collect <span class="op">=</span> <span class="cn">TRUE</span>, conn <span class="op">=</span> <span class="va">conn</span>,</span>
<span>    schema <span class="op">=</span> <span class="va">schema</span>, fk_parent_tables <span class="op">=</span> <span class="va">fk_parent_tables</span><span class="op">)</span>,</span>
<span>  matrix_class <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Matrix"</span>, <span class="st">"matrix"</span><span class="op">)</span>,</span>
<span>  matname <span class="op">=</span> <span class="fu">PFUPipelineTools</span><span class="fu">::</span><span class="va"><a href="mat_meta_cols.html">mat_meta_cols</a></span><span class="op">$</span><span class="va">matname</span>,</span>
<span>  matval <span class="op">=</span> <span class="fu">PFUPipelineTools</span><span class="fu">::</span><span class="va"><a href="mat_meta_cols.html">mat_meta_cols</a></span><span class="op">$</span><span class="va">matval</span>,</span>
<span>  rowtype_colname <span class="op">=</span> <span class="fu">PFUPipelineTools</span><span class="fu">::</span><span class="va"><a href="mat_meta_cols.html">mat_meta_cols</a></span><span class="op">$</span><span class="va">rowtype</span>,</span>
<span>  coltype_colname <span class="op">=</span> <span class="fu">PFUPipelineTools</span><span class="fu">::</span><span class="va"><a href="mat_meta_cols.html">mat_meta_cols</a></span><span class="op">$</span><span class="va">coltype</span>,</span>
<span>  valid_from_version_colname <span class="op">=</span> <span class="fu">PFUPipelineTools</span><span class="fu">::</span><span class="va"><a href="dataset_info.html">dataset_info</a></span><span class="op">$</span><span class="va">valid_from_version_colname</span>,</span>
<span>  valid_to_version_colname <span class="op">=</span> <span class="fu">PFUPipelineTools</span><span class="fu">::</span><span class="va"><a href="dataset_info.html">dataset_info</a></span><span class="op">$</span><span class="va">valid_to_version_colname</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-db-table-name">db_table_name<a class="anchor" aria-label="anchor" href="#arg-db-table-name"></a></dt>
<dd><p>The string name of the database table to be filtered.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>Filter conditions on the data frame,
such as <code>Country == "USA"</code> or <code>Year %in% 1960:2020</code>.
These conditions reduce data volume,
because they are applied prior to downloading from <code>conn</code>.
If no rows match these conditions,
a data frame with no rows is returned.</p></dd>


<dt id="arg-version-string">version_string<a class="anchor" aria-label="anchor" href="#arg-version-string"></a></dt>
<dd><p>A string of length <code>1</code> or more
that indicates the desired version(s).
<code>NULL</code>, the default, means to download all versions available in
<code>db_table_name</code>.
<code><a href="https://rdrr.io/r/base/c.html" class="external-link">c()</a></code> (an empty string) returns a zero-row table.
If <code>version_string</code> is invalid, an error will be emitted.</p></dd>


<dt id="arg-collect">collect<a class="anchor" aria-label="anchor" href="#arg-collect"></a></dt>
<dd><p>A boolean that tells whether to download the result.
Default is <code>FALSE</code>.
See details.</p></dd>


<dt id="arg-create-matsindf">create_matsindf<a class="anchor" aria-label="anchor" href="#arg-create-matsindf"></a></dt>
<dd><p>A boolean that tells whether to create a matsindf data frame
from the collected data frame.
Default is the value of <code>collect</code>,
such that setting <code>collect = TRUE</code> also
implies <code>create_matsindf</code>.</p></dd>


<dt id="arg-conn">conn<a class="anchor" aria-label="anchor" href="#arg-conn"></a></dt>
<dd><p>The database connection.</p></dd>


<dt id="arg-schema">schema<a class="anchor" aria-label="anchor" href="#arg-schema"></a></dt>
<dd><p>The data model (<code>dm</code> object) for the database in <code>conn</code>.
Default is <code>schema_from_conn(conn = conn)</code>.
See details.</p></dd>


<dt id="arg-fk-parent-tables">fk_parent_tables<a class="anchor" aria-label="anchor" href="#arg-fk-parent-tables"></a></dt>
<dd><p>A named list of all parent tables
for the foreign keys in <code>db_table_name</code>.
Default is
<code>get_all_fk_tables(conn = conn, schema = schema)</code>.
See details.</p></dd>


<dt id="arg-index-map-name">index_map_name<a class="anchor" aria-label="anchor" href="#arg-index-map-name"></a></dt>
<dd><p>The name of the table that serves as the index for row and column names.
Default is "Index".</p></dd>


<dt id="arg-index-map">index_map<a class="anchor" aria-label="anchor" href="#arg-index-map"></a></dt>
<dd><p>The index map for the matrices in the database at <code>conn</code>.
Default is <code>fk_parent_tables[[index_table_name]]</code>.</p></dd>


<dt id="arg-rctype-table-name">rctype_table_name<a class="anchor" aria-label="anchor" href="#arg-rctype-table-name"></a></dt>
<dd><p>The name of the table that contains row and column types.
Default is "matnameRCType".</p></dd>


<dt id="arg-rctypes">rctypes<a class="anchor" aria-label="anchor" href="#arg-rctypes"></a></dt>
<dd><p>The table of row and column types for the database at <code>conn</code>.
Default is <code>fk_parent_tables[[rctype_table_name]]</code>.</p></dd>


<dt id="arg-matrix-class">matrix_class<a class="anchor" aria-label="anchor" href="#arg-matrix-class"></a></dt>
<dd><p>One of "Matrix" (the default) for sparse matrices or
"matrix" (the base matrix representation in <code>R</code>) for non-sparse matrices.</p></dd>


<dt id="arg-matname">matname<a class="anchor" aria-label="anchor" href="#arg-matname"></a></dt>
<dd><p>The name of the matrix name column.
Default is <code>PFUPipelineTools::mat_meta_cols$matname</code>.</p></dd>


<dt id="arg-matval">matval<a class="anchor" aria-label="anchor" href="#arg-matval"></a></dt>
<dd><p>The name of the matrix value column.
Default is <code>PFUPipelineTools::mat_meta_cols$matval</code>.</p></dd>


<dt id="arg-rowtype-colname-coltype-colname">rowtype_colname, coltype_colname<a class="anchor" aria-label="anchor" href="#arg-rowtype-colname-coltype-colname"></a></dt>
<dd><p>The names for row and column type columns in data frames.
Defaults are
<code>PFUPipelineTools::mat_meta_cols$rowtype</code> and
<code>PFUPipelineTools::mat_meta_cols$coltype</code>,
respectively.</p></dd>


<dt id="arg-valid-from-version-colname-valid-to-version-colname">valid_from_version_colname, valid_to_version_colname<a class="anchor" aria-label="anchor" href="#arg-valid-from-version-colname-valid-to-version-colname"></a></dt>
<dd><p>Names
for columns containing version information.
Defaults are
<code>PFUPipelineTools::dataset_info$valid_from_version_colname</code>
and
<code>PFUPipelineTools::dataset_info$valid_to_version_colname</code>,
respectively.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A filtered version of <code>db_table_name</code> downloaded from <code>conn</code>.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p><code>schema</code> is a data model (<code>dm</code> object) for the CL-PFU database.
It can be obtained from calling <code><a href="schema_from_conn.html">schema_from_conn()</a></code>.
If minimal interaction with the database is desired,
be sure to override the default value for <code>schema</code>
by supplying a pre-computed <code>dm</code> object.</p>
<p><code>fk_parent_tables</code> is a named list of tables,
some of which are fk parent tables containing
the mapping between fk values (usually strings)
and fk keys (usually integers)
for <code>db_table_name</code>.
<code>fk_parent_tables</code> is treated as a store from which foreign key tables
are retrieved by name when needed.
An appropriate value for <code>fk_parent_tables</code> can be obtained
from <code><a href="get_all_fk_tables.html">get_all_fk_tables()</a></code>.
If minimal interaction with the database is desired,
be sure to override the default value for <code>fk_parent_tables</code>
by supplying a pre-computed named list of
foreign key tables.</p>
    </div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Matthew Heun.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.2.</p>
</div>

    </footer></div>





  </body></html>

