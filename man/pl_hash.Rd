% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/storing.R
\name{pl_hash}
\alias{pl_hash}
\title{Calculate has of pipeline data}
\usage{
pl_hash(
  .df,
  table_name,
  .table_name_col = PFUPipelineTools::hashed_table_colnames$db_table_name,
  .nested_col = PFUPipelineTools::hashed_table_colnames$nested_col_name,
  .nested_hash_col = PFUPipelineTools::hashed_table_colnames$nested_hash_col_name,
  .algo = "md5"
)
}
\arguments{
\item{.df}{The data frame to be stored in the database.}

\item{table_name}{The name of the table in which \code{.df} will be stored.}

\item{.table_name_col}{The name of the column of the output that contains \code{table_name} on output.
Default is \code{PFUPipelineTools::hashed_table_colnames$db_table_name}.}

\item{.nested_col}{The name of the column of the output that contains
the has of nested columns.
Default is \code{PFUPipelineTools::hashed_table_colnames$nested_col_name}.}

\item{.algo}{The algorithm for hashing.
Default is "md5".}
}
\value{
A modified version of \code{.df} without groups. See details.
}
\description{
In the CL-PFU database pipeline,
we need the ability to download a
data frame from the database
based on a hash of the data.
This function calculates the appropriate hash.
}
\details{
The hash has two requirements:
\itemize{
\item values change when content changes and
\item provides sufficient information to retrieve the real data frame.
}

The uploaded data frames may be created by
grouped calculations,
so some columns are likely to have only one unique value.
We need to know retain data of those single-valued columns
as well as the name of the database table.

To meet those requirements,
the return value from this function
has the following characteristics:
\itemize{
\item The first column (named with the value of \code{.table_name_col})
contains the value of \code{table_name}, the name
of the database table where \code{.df} is stored.
\item The second through N-1 columns are others with only one unique value.
\item The Nth column (named with the value of \code{.nested_col})
contains a hash of a data frame created by nesting
all columns with more than one unique value.
}

When data are withdrawn from the database at a later time,
the first column can be removed, and
the other columns with one unique
value can be filtered.
}
