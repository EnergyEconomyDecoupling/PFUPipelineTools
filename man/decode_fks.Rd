% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/schema.R
\name{decode_fks}
\alias{decode_fks}
\title{Decode keys in a database table}
\usage{
decode_fks(
  .df = NULL,
  db_table_name,
  conn,
  collect = FALSE,
  schema = schema_from_conn(conn),
  fk_parent_tables = get_all_fk_tables(conn = conn, schema = schema),
  .child_table = PFUPipelineTools::dm_fk_colnames$child_table,
  .child_fk_cols = PFUPipelineTools::dm_fk_colnames$child_fk_cols,
  .parent_key_cols = PFUPipelineTools::dm_fk_colnames$parent_key_cols,
  .pk_suffix = PFUPipelineTools::key_col_info$pk_suffix,
  .y_joining_suffix = ".y"
)
}
\arguments{
\item{.df}{A data frame whose foreign keys are to be decoded.
Default is \code{NULL}, meaning that
\code{.df} should be downloaded from \code{db_table_name} at \code{conn}
before decoding foreign keys.}

\item{db_table_name}{The string name of the database table where \code{.df} is to be uploaded.}

\item{conn}{An optional database connection.
Necessary only for the default values of \code{schema} and \code{fk_parent_tables}.}

\item{collect}{A boolean that tells whether to download the decoded table
(returning an in-memory data frame produced by calling
\code{dplyr::collect()}) or
a \code{tbl} (a reference to a database query to be executed
by \code{dplyr::collect()}).
Default is \code{FALSE}.
Applies only when \code{.df} is \code{NULL}.
Note that to prevent downloads
from \code{conn}, supply a value for \code{schema},
whose default value will download a \code{dm} object
from the database at \code{conn}.}

\item{schema}{The data model (\code{dm} object) for the database in \code{conn}.
See details.}

\item{fk_parent_tables}{A named list of all parent tables
for the foreign keys in \code{db_table_name}.
See details.}

\item{.child_table, .child_fk_cols, .parent_key_cols}{See \code{PFUPipelineTools::dm_fk_colnames}.}

\item{.pk_suffix}{See \code{PFUPipelineTools::key_col_info}.}

\item{.y_joining_suffix}{The y column name suffix for \code{left_join()}.
Default is ".y".}
}
\value{
A version of \code{.df} with integer keys replaced by key values.
}
\description{
When querying a table from a database,
it is helpful to decode the primary and foreign keys
in the data frame,
i.e. to translate from keys to values.
This function provides that service.
}
\details{
\code{schema} is a data model (\code{dm} object) for the CL-PFU database.
It can be obtained from calling \code{schema_from_conn()}.
The default is \code{schema_from_conn(conn = conn)},
which downloads the \code{dm} object from \code{conn}.
To save time, pre-compute the \code{dm} object and
supply in the \code{schema} argument.

\code{fk_parent_tables} is a named list of tables,
some of which are foreign key (fk) parent tables for \code{db_table_name}
containing the mapping between fk values (usually strings)
and fk keys (usually integers).
\code{fk_parent_tables} is treated as a store from which foreign key tables
are retrieved by name when needed.
An appropriate value for \code{fk_parent_tables} can be obtained
from \code{get_all_fk_tables()}.
}
\seealso{
\code{\link[=encode_fks]{encode_fks()}} for the reverse operation.
}
