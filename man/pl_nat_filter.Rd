% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/retrieving.R
\name{pl_nat_filter}
\alias{pl_nat_filter}
\title{Filter a table from the database with natural expressions}
\usage{
pl_nat_filter(
  db_table_name,
  ...,
  conn,
  schema = schema_from_conn(conn = conn),
  fk_parent_tables = get_all_fk_tables(conn = conn, schema = schema)
)
}
\arguments{
\item{db_table_name}{The name of a database table.}

\item{...}{Natural filtering commands, such as would be applied
in the \code{...} argument of \code{dplyr::filter()}.}

\item{conn}{The database connection.}

\item{schema}{The data model (\code{dm} object) for the database in \code{conn}.
See details.}

\item{fk_parent_tables}{A named list of all parent tables
for the foreign keys in \code{db_table_name}.
See details.}
}
\value{
A data frame downloaded from \code{conn}, a filtered version of \code{db_table_name}.
}
\description{
Often when collecting data from the database,
filtering is desired.
But filtering based on foreign keys is effectively impossible,
because of their encoding.
This function filters based on foreign key values,
not foreign key integers,
thereby simplifying the filtering process.
A \code{tbl} is returned.
Use \code{dplyr::collect()} to execute the query.
}
\details{
\code{schema} is a data model (\code{dm} object) for the CL-PFU database.
It can be obtained from calling \code{schema_from_conn()}.

\code{fk_parent_tables} is a named list of tables,
some of which are fk parent tables containing
the mapping between fk values (usually strings)
and fk keys (usually integers)
for \code{db_table_name}.
\code{fk_parent_tables} is treated as a store from which foreign key tables
are retrieved by name when needed.
An appropriate value for \code{fk_parent_tables} can be obtained
from \code{get_all_fk_tables()}.
}
