% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/utilities.R
\name{encode_fk_values}
\alias{encode_fk_values}
\title{Encode a vector of foreign key values according to a foreign key parent table}
\usage{
encode_fk_values(
  v_val,
  fk_table_name,
  conn,
  schema = schema_from_conn(conn),
  fk_parent_tables = get_all_fk_tables(conn = conn, schema = schema, collect = TRUE),
  pk_suffix = PFUPipelineTools::key_col_info$pk_suffix
)
}
\arguments{
\item{v_val}{A vector of fk values (typically strings) to be converted
to fk keys (typically integers).}

\item{fk_table_name}{The name of the foreign key table in \code{conn}
that contains the mapping from fk values
to fk keys.}

\item{conn}{A connection to the CL-PFU database.
Needed only if \code{fk_parent_tables} is not provided.}

\item{schema}{The data model (\code{dm} object) for the database in \code{conn}.
Default is \code{dm_from_con(conn, learn_keys = TRUE)}.
Needed only if \code{fk_parent_tables} is not provided.
See details.}

\item{fk_parent_tables}{A named list of all parent tables
for the foreign keys in \code{db_table_name}.
See details.}

\item{pk_suffix}{A string that gives the suffix for
primary key columns.
Default is \code{PFUPipelineTools::key_col_info$pk_suffix}.}
}
\value{
\code{v_val} encoded according to \code{fk_parent_tables}.
}
\description{
In a database, there are foreign key tables
containing fk values (usually strings) and fk keys (usually integers).
This function converts a vector of fk values (strings, \code{v_val})
into a vector fk keys (integers) according to the
database at \code{conn}.
}
\details{
\code{schema} is a data model (\code{dm} object) for the database in \code{conn}.
Its default value (\code{schema_from_conn(conn)})
extracts the data model for the database at \code{conn} automatically.
However, if the caller already has the data model,
supplying it in the \code{schema} argument will save time.

\code{fk_parent_tables} is a named list of tables,
one of which (the one named \code{fk_table_name})
contains the foreign keys \code{v}.
\code{fk_parent_tables} is treated as a store from which foreign key tables
are retrieved by name when needed.
The default value (which calls \code{get_all_fk_tables()}
with \code{collect = TRUE})
retrieves all possible foreign key parent tables from \code{conn},
potentially a time-consuming process.
For speed, pre-compute all foreign key parent tables once
(via \code{get_all_fk_tables(collect = TRUE)})
and pass the list to the \code{fk_parent_tables} argument
of this function.
}
\examples{
fk_parent_tables <- list(
  Country = tibble::tribble(~CountryID, ~Country,
                            1, "USA",
                            2, "ZAF",
                            3, "GHA"))
encode_fk_values(c("USA", "USA", "GHA"),
                 fk_table_name = "Country",
                 fk_parent_tables = fk_parent_tables)
}
