% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/utilities.R
\name{inboard_filter_copy}
\alias{inboard_filter_copy}
\title{Copy a country, year subset from one table to another}
\usage{
inboard_filter_copy(
  source,
  dest,
  countries = NULL,
  years = NULL,
  empty_dest = TRUE,
  in_place = FALSE,
  dependencies = NULL,
  additional_hash_group_cols = NULL,
  usual_hash_group_cols = PFUPipelineTools::usual_hash_group_cols,
  conn,
  schema = schema_from_conn(conn),
  fk_parent_tables = get_all_fk_tables(conn = conn, schema = schema),
  country = IEATools::iea_cols$country,
  year = IEATools::iea_cols$year,
  pk_suffix = PFUPipelineTools::key_col_info$pk_suffix
)
}
\arguments{
\item{source}{A string identifying the source table.}

\item{dest}{A string identifying the destination table.}

\item{countries}{Countries to keep.}

\item{years}{Years to keep.}

\item{empty_dest}{A boolean that tells whether to empty the destination table before copying.
Default is \code{TRUE}.}

\item{in_place}{A boolean that tells whether to make the changes in the remote
database at \code{conn}.}

\item{dependencies}{Other objects (often targets) upon which the inboard copy depends.
The default is \code{NULL}.
See details.}

\item{additional_hash_group_cols}{A vector of strings that gives names of additional
columns that should \emph{not} be hashed.}

\item{usual_hash_group_cols}{A string vector that gives typical names of columns that should \emph{not}
be hashed.
Default is \code{PFUPipelineTools::usual_hash_group_cols}.}

\item{conn}{A database connection.}

\item{schema}{The data model (\code{dm} object) for the database in \code{conn}.
Default is \code{dm_from_con(conn, learn_keys = TRUE)}.
See details.}

\item{fk_parent_tables}{A named list of all parent tables
for the foreign keys in \code{db_table_name}.
See details.}

\item{country}{The name of the country column in \code{source} and \code{dest}.
Default is \code{IEATools::iea_cols$country}.}

\item{year}{The name of the year column in \code{source} and \code{dest}.
Default is \code{IEATools::iea_cols$year}.}

\item{pk_suffix}{The suffix for primary key columns.
Default is \code{PFUPipelineTools::key_col_info$pk_suffix}.}
}
\value{
A hash of the destination data frame
created by \code{\link[=pl_upsert]{pl_upsert()}}.
}
\description{
Inboard copying of tables is much faster than round-tripping
data from the database to the local machine and back.
This function does an inboard filter and copy
from \code{source} to \code{dest} in \code{conn},
optionally emptying \code{dest} first.
}
\details{
The \code{source} and \code{dest} tables should have identical columns.

The \code{dependencies} argument can be a vector of other objects
upon which the desired inboard copy depends.
Typically, the target that makes \code{source} should be given in \code{dependencies},
for unless the target that makes \code{source} completes,
the inboard filter copy will fail.
\code{dependencies} is ignored internally.

\code{schema} is a data model (\code{dm} object) for the database in \code{conn}.
Its default value (\code{schema_from_conn(conn)})
extracts the data model for the database at \code{conn} automatically.
However, if the caller already has the data model,
supplying it in the \code{schema} argument will save time.

\code{fk_parent_tables} is a named list of tables,
one of which (the one named \code{db_table_name})
contains the foreign keys for \code{db_table_name}.
\code{fk_parent_tables} is treated as a store from which foreign key tables
are retrieved by name when needed.
The default value (which calls \code{get_all_fk_tables()}
with \code{collect = TRUE} because decoding of foreign keys
is done outboard of the database)
retrieves all possible foreign key parent tables from \code{conn},
potentially a time-consuming process.
For speed, pre-compute all foreign key parent tables once
(via \code{get_all_fk_tables(collect = TRUE)})
and pass the list to the \code{fk_parent_tables} argument
of this function.
}
